<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VAVOO.TO - EXCLUSIVE PLAYER</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --neon: #00ff41; /* Vert Matrix/Hacker */
            --bg: #050505;
            --panel: #111;
            --text: #fff;
        }
        
        body { margin: 0; padding: 0; font-family: 'Courier New', monospace; background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        
        /* HEADER STYLE HACKER */
        header { height: 50px; background: #000; border-bottom: 1px solid var(--neon); display: flex; align-items: center; justify-content: space-between; padding: 0 15px; }
        .brand { font-weight: bold; font-size: 18px; color: var(--neon); text-shadow: 0 0 5px var(--neon); letter-spacing: 2px; }
        .vpn-alert { font-size: 11px; background: #220000; color: #ff4444; padding: 4px 10px; border: 1px solid #ff4444; border-radius: 3px; }

        /* LAYOUT */
        .main-container { display: flex; flex: 1; height: calc(100vh - 50px); }
        
        /* VIDEO */
        .video-box { flex: 1; background: #000; position: relative; display: flex; align-items: center; justify-content: center; }
        video { width: 100%; height: 100%; outline: none; }
        
        /* SIDEBAR */
        .sidebar { width: 350px; background: var(--panel); border-left: 1px solid #333; display: flex; flex-direction: column; }
        
        .search-bar { padding: 10px; border-bottom: 1px solid #333; }
        input { width: 100%; background: #000; border: 1px solid #333; color: var(--neon); padding: 10px; font-family: monospace; box-sizing: border-box; }
        input:focus { border-color: var(--neon); outline: none; }

        .list-container { flex: 1; overflow-y: auto; }
        
        .channel { padding: 12px 10px; border-bottom: 1px solid #222; cursor: pointer; display: flex; align-items: center; transition: 0.2s; }
        .channel:hover { background: #1a1a1a; }
        .channel.active { background: rgba(0, 255, 65, 0.1); border-left: 3px solid var(--neon); }
        
        .logo { width: 40px; height: 40px; object-fit: contain; background: #fff; border-radius: 3px; margin-right: 10px; padding: 2px; }
        .name { font-size: 12px; font-weight: bold; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
        .group { font-size: 10px; color: #888; margin-top: 3px; }

        /* LOADING SCREEN */
        #loading-screen { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.95); z-index: 999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .loader-text { color: var(--neon); margin-top: 10px; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }

        @media (max-width: 800px) { .main-container { flex-direction: column; } .sidebar { width: 100%; height: 50%; } }
    </style>
</head>
<body>

<div id="loading-screen">
    <i class="fas fa-satellite-dish fa-spin" style="font-size: 40px; color: var(--neon);"></i>
    <div class="loader-text">DÉCHIFFREMENT DES CLÉS VAVOO...</div>
    <div style="color:#666; font-size:10px; margin-top:5px;">Connexion au serveur Kodinerds</div>
</div>

<header>
    <div class="brand">VAVOO<span style="color:white;">.TO</span></div>
    <div class="vpn-alert" id="vpn-status">⚠️ VPN ALLEMAGNE REQUIS</div>
</header>

<div class="main-container">
    <div class="video-box">
        <video id="video" controls autoplay playsinline></video>
    </div>
    <div class="sidebar">
        <div class="search-bar">
            <input type="text" id="search" placeholder="Chercher (Sky, Pro7, DAZN...)" oninput="handleSearch()">
        </div>
        <div class="list-container" id="scroll-area">
            <div id="list-content"></div>
        </div>
    </div>
</div>

<script>
    // URL SPÉCIALE VAVOO (KODINERDS)
    // Cette liste contient les tokens "?n=..." nécessaires pour vavoo.to
    const VAVOO_URL = "https://raw.githubusercontent.com/jnk22/kodinerds-iptv/master/iptv/clean/vavoo.m3u";
    
    // Proxy pour contourner le blocage du téléchargement de la liste M3U
    const PROXY = "https://api.allorigins.win/raw?url=";

    let db = []; // Base de données complète
    let currentList = []; // Liste filtrée
    let rendered = 0;
    const BATCH = 50;

    const listArea = document.getElementById('list-content');
    const scrollArea = document.getElementById('scroll-area');
    const loader = document.getElementById('loading-screen');
    const video = document.getElementById('video');
    let hls = null;

    // 1. Démarrage
    window.onload = async () => {
        try {
            // On passe par le proxy pour récupérer le texte M3U
            const res = await fetch(PROXY + encodeURIComponent(VAVOO_URL));
            const text = await res.text();
            parseM3U(text);
        } catch (e) {
            alert("Erreur: Impossible de charger la liste Vavoo. Vérifiez votre connexion.");
        }
    };

    // 2. Parsing M3U
    function parseM3U(data) {
        const lines = data.split('\n');
        let item = {};
        db = [];

        for(let line of lines) {
            line = line.trim();
            if(line.startsWith('#EXTINF:')) {
                const info = line.split(',');
                item.name = info[1] || "Vavoo Stream";
                
                const logo = line.match(/tvg-logo="([^"]*)"/);
                item.logo = logo ? logo[1] : "";
                
                const grp = line.match(/group-title="([^"]*)"/);
                item.group = grp ? grp[1] : "VAVOO";
            } 
            else if(line.startsWith('http')) {
                item.url = line;
                // On filtre pour ne garder que les vrais liens
                if(item.name) db.push({...item});
                item = {};
            }
        }

        currentList = db;
        loader.style.display = 'none';
        renderBatch(true);
    }

    // 3. Affichage (Scroll Infini)
    function renderBatch(reset = false) {
        if(reset) {
            listArea.innerHTML = "";
            rendered = 0;
            scrollArea.scrollTop = 0;
        }

        const max = Math.min(rendered + BATCH, currentList.length);
        const frag = document.createDocumentFragment();

        for(let i = rendered; i < max; i++) {
            const ch = currentList[i];
            const div = document.createElement('div');
            div.className = "channel";
            div.innerHTML = `
                <img src="${ch.logo}" class="logo" onerror="this.style.display='none'">
                <div>
                    <div class="name">${ch.name}</div>
                    <div class="group">${ch.group}</div>
                </div>
            `;
            div.onclick = () => playVavoo(ch.url, div);
            frag.appendChild(div);
        }

        listArea.appendChild(frag);
        rendered = max;
    }

    scrollArea.addEventListener('scroll', () => {
        if(scrollArea.scrollTop + scrollArea.clientHeight >= scrollArea.scrollHeight - 100) {
            if(rendered < currentList.length) renderBatch();
        }
    });

    // 4. Recherche
    function handleSearch() {
        const q = document.getElementById('search').value.toLowerCase();
        if(q.length < 2) currentList = db;
        else currentList = db.filter(c => c.name.toLowerCase().includes(q) || c.group.toLowerCase().includes(q));
        renderBatch(true);
    }

    // 5. Lecteur Vidéo (Spécial Vavoo)
    function playVavoo(url, el) {
        document.querySelectorAll('.channel').forEach(e => e.classList.remove('active'));
        if(el) el.classList.add('active');

        // Note: Les liens Vavoo contiennent souvent "?n=..." (signature).
        // Si ça ne marche pas, c'est souvent un blocage User-Agent.
        
        if (Hls.isSupported()) {
            if (hls) hls.destroy();
            hls = new Hls({
                xhrSetup: function(xhr, url) {
                    // Tentative d'optimisation
                    xhr.withCredentials = false;
                }
            });
            hls.loadSource(url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => {
                video.play();
                document.getElementById('vpn-status').style.background = "#002200";
                document.getElementById('vpn-status').style.color = "#00ff00";
                document.getElementById('vpn-status').style.borderColor = "#00ff00";
                document.getElementById('vpn-status').innerText = "CONNEXION SÉCURISÉE";
            });
            hls.on(Hls.Events.ERROR, (e, data) => {
                if(data.fatal) {
                    console.log("Erreur Fatale VAVOO");
                    // Souvent dû au manque de VPN ou CORS
                }
            });
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            video.src = url;
            video.play();
        }
    }
</script>

</body>
</html>
